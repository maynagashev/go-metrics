# Конфигурация в формате JSON

В проекте реализована возможность конфигурации сервера и агента с помощью файла в формате JSON. Это позволяет удобно настраивать приложение без необходимости передавать множество параметров через командную строку или переменные окружения.

## Приоритет настроек

Настройки применяются в следующем порядке (от высшего приоритета к низшему):

1. Флаги командной строки
2. Переменные окружения
3. Файл конфигурации JSON

Это означает, что если одна и та же настройка указана в нескольких местах, будет использовано значение с наивысшим приоритетом.

## Указание пути к файлу конфигурации

Путь к файлу конфигурации можно указать одним из следующих способов:

- Через флаг `-c` или `-config`: `./server -c /path/to/config.json`
- Через переменную окружения `CONFIG`: `CONFIG=/path/to/config.json ./server`

## Конфигурация сервера

Пример конфигурационного файла для сервера:

```json
{
    "address": "localhost:8080",
    "restore": true,
    "store_interval": "5m",
    "store_file": "/tmp/metrics-db.json",
    "database_dsn": "postgres://metrics:password@localhost:5432/metrics",
    "crypto_key": "/path/to/private-key.pem",
    "enable_pprof": false
}
```

### Параметры конфигурации сервера

| Параметр JSON     | Флаг командной строки | Переменная окружения | Описание                                                |
|-------------------|------------------------|----------------------|----------------------------------------------------------|
| address           | -a                     | ADDRESS              | Адрес и порт сервера                                     |
| restore           | -r                     | RESTORE              | Восстанавливать метрики из файла при старте              |
| store_interval    | -i                     | STORE_INTERVAL       | Интервал сохранения метрик (например, "5m" - 5 минут)    |
| store_file        | -f                     | FILE_STORAGE_PATH    | Путь к файлу для хранения метрик                         |
| database_dsn      | -d                     | DATABASE_DSN         | Строка подключения к базе данных                         |
| crypto_key        | -crypto-key            | CRYPTO_KEY           | Путь к файлу с приватным ключом для расшифровки          |
| enable_pprof      | -pprof                 | -                    | Включить профилирование через pprof                      |

## Конфигурация агента

Пример конфигурационного файла для агента:

```json
{
    "address": "localhost:8080",
    "report_interval": "10s",
    "poll_interval": "2s",
    "crypto_key": "/path/to/public-key.pem",
    "rate_limit": 3,
    "enable_pprof": false,
    "pprof_port": "6060"
}
```

### Параметры конфигурации агента

| Параметр JSON     | Флаг командной строки | Переменная окружения | Описание                                                |
|-------------------|------------------------|----------------------|----------------------------------------------------------|
| address           | -a                     | ADDRESS              | Адрес и порт сервера                                     |
| report_interval   | -r                     | REPORT_INTERVAL      | Интервал отправки метрик (например, "10s" - 10 секунд)   |
| poll_interval     | -p                     | POLL_INTERVAL        | Интервал сбора метрик (например, "2s" - 2 секунды)       |
| crypto_key        | -crypto-key            | CRYPTO_KEY           | Путь к файлу с публичным ключом для шифрования           |
| rate_limit        | -l                     | RATE_LIMIT           | Максимальное количество одновременно исходящих запросов  |
| enable_pprof      | -pprof                 | -                    | Включить профилирование через pprof                      |
| pprof_port        | -pprof-port            | -                    | Порт для pprof сервера                                   |

## Формат времени

Интервалы времени указываются в формате Go duration string, например:
- "5s" - 5 секунд
- "1m" - 1 минута
- "2h" - 2 часа
- "1h30m" - 1 час 30 минут 