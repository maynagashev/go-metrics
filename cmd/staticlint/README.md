# Staticlint

Staticlint - это кастомный статический анализатор кода для Go, объединяющий различные линтеры для проверки кода.

## Состав анализатора

Анализатор включает в себя:

1. **Собственные анализаторы**:
   - `errcheck` - проверяет необработанные ошибки в коде
   - `noexit` - запрещает использовать прямой вызов os.Exit в функции main пакета main

2. **Стандартные анализаторы** из пакета `golang.org/x/tools/go/analysis/passes`:
   - `printf` - проверяет корректность форматных строк в функциях printf
   - `shadow` - проверяет наличие затененных переменных
   - `structtag` - проверяет корректность тегов структур

3. **Все анализаторы класса SA** из пакета `staticcheck.io`:
   - SA1000-SA9999 - различные проверки корректности кода

4. **Дополнительные анализаторы** из других классов пакета `staticcheck.io`:
   - ST1000 - проверка наличия комментария к пакету
   - Другие анализаторы, указанные в конфигурационном файле

5. **Публичные анализаторы**:
   - `exhaustive` - проверяет полноту switch для перечислений (enums). Этот анализатор гарантирует, что все возможные значения перечисления обрабатываются в switch-case конструкциях, что помогает избежать ошибок при добавлении новых значений в enum.
   - `bodyclose` - проверяет, что тела HTTP-ответов закрываются. Этот анализатор помогает избежать утечек ресурсов при работе с HTTP-клиентами, гарантируя, что метод `resp.Body.Close()` вызывается для всех HTTP-ответов.

## Конфигурация

Анализатор поддерживает конфигурационный файл `config.json`, который должен находиться в текущей директории или в директории `cmd/staticlint`. Пример содержимого файла:

```json
{
    "staticcheck": [
        "SA4006",
        "SA5000",
        "SA6000",
        "SA9004"
    ],
    "stylecheck": [
        "ST1000",
        "ST1003",
        "ST1005"
    ]
}
```

## Использование

Для запуска анализатора выполните:

```bash
go run cmd/staticlint/staticlint.go ./...
```

или скомпилируйте и запустите:

```bash
go build -o staticlint ./cmd/staticlint
./staticlint ./...
```

## Примечание

В текущей реализации анализатор читает конфигурационный файл и добавляет анализаторы из staticcheck и stylecheck, указанные в этом файле. 
Если файл конфигурации отсутствует или содержит ошибки, анализатор запускает все доступные анализаторы.

## Описание анализаторов

### Собственные анализаторы

#### errcheck

Анализатор `errcheck` проверяет, что все возвращаемые ошибки обрабатываются в коде. Это помогает избежать ситуаций, когда ошибки игнорируются, что может привести к непредсказуемому поведению программы.

#### noexit

Анализатор `noexit` запрещает использовать прямой вызов `os.Exit` в функции `main` пакета `main`. Это помогает обеспечить корректное завершение программы, позволяя выполнить все отложенные операции (defer) и освободить ресурсы.

### Публичные анализаторы

#### exhaustive

Анализатор `exhaustive` проверяет полноту switch для перечислений (enums). Этот анализатор гарантирует, что все возможные значения перечисления обрабатываются в switch-case конструкциях, что помогает избежать ошибок при добавлении новых значений в enum.

#### bodyclose

Анализатор `bodyclose` проверяет, что тела HTTP-ответов закрываются. Этот анализатор помогает избежать утечек ресурсов при работе с HTTP-клиентами, гарантируя, что метод `resp.Body.Close()` вызывается для всех HTTP-ответов.

### Анализаторы из staticcheck

Анализаторы класса SA из пакета staticcheck.io проверяют различные аспекты корректности кода, включая:
- Проверка корректности регулярных выражений (SA1000)
- Проверка корректности форматных строк (SA1009)
- Проверка корректности использования контекста (SA1012)
- Проверка корректности использования мьютексов (SA2000)
- Проверка корректности использования горутин (SA2002)
- И многие другие

### Анализаторы из stylecheck

Анализаторы из пакета stylecheck.io проверяют стиль кода, включая:
- Проверка наличия комментария к пакету (ST1000)
- Проверка корректности именования идентификаторов (ST1003)
- Проверка корректности форматирования строк ошибок (ST1005)
- И другие

## Полезные проверки

Анализатор включает в себя широкий набор проверок, которые помогут улучшить качество кода:
- Проверка обработки ошибок
- Поиск проблем с конкурентностью
- Анализ использования nil
- Проверка HTTP-обработчиков
- Поиск неиспользуемого кода
- Проверка форматирования и стиля кода
- Проверка полноты обработки перечислений
- Проверка закрытия тел HTTP-ответов
- Запрет на использование os.Exit в main
- И многие другие 